<!doctype html><html lang=en-us data-theme><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer-when-downgrade"><title>mock-inspect: Mock network requests and observe how these requests were made - rickschubert.net blog</title><meta name=description content><link rel=icon type=image/x-icon href=https://rickschubert.net/blog/favicon.ico><link rel=apple-touch-icon-precomposed href=https://rickschubert.net/blog/favicon.png><link rel=stylesheet href=https://rickschubert.net/blog/css/style.min.ada65744b50c0c8e95fce70ffd6071f0d8830f31d28d4629c2a760b4cd8f97d1.css integrity><meta property="og:title" content="mock-inspect: Mock network requests and observe how these requests were made"><meta property="og:description" content="This article is part of a series about the open-source Node.js testing library mock-inspect of which I am the main contributor and author. Check out the entire series here! mock-inspect is an open-source library for Node.js which allows you to mock network requests in your tests and to inspect how these requests have been made in the application. Has the endpoint been called? Which request body and request headers did the application pass along?"><meta property="og:type" content="article"><meta property="og:url" content="https://rickschubert.net/blog/posts/mock-inspect-what-it-is-and-how-to-use-it/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-05-10T23:19:54+01:00"><meta property="article:modified_time" content="2021-05-10T23:19:54+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="mock-inspect: Mock network requests and observe how these requests were made"><meta name=twitter:description content="This article is part of a series about the open-source Node.js testing library mock-inspect of which I am the main contributor and author. Check out the entire series here! mock-inspect is an open-source library for Node.js which allows you to mock network requests in your tests and to inspect how these requests have been made in the application. Has the endpoint been called? Which request body and request headers did the application pass along?"><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-252785X60E","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><a class=skip-main href=#main>Skip to main content</a><div class=container><header class=common-header><div class=site-header><a class=site-title href=https://rickschubert.net/blog/>rickschubert.net blog</a>
<button class=theme-switcher></button>
<script>const moonSVG=`<svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path></svg>`,sunSVG=`<svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>`,STORAGE_KEY="user-color-scheme",defaultTheme="auto";let currentTheme,switchButton,autoDefinedScheme=window.matchMedia("(prefers-color-scheme: dark)");const autoChangeScheme=e=>{currentTheme=e.matches?"dark":"light",document.documentElement.setAttribute("data-theme",currentTheme),changeButtonText()};document.addEventListener("DOMContentLoaded",function(){switchButton=document.querySelector(".theme-switcher"),currentTheme=detectCurrentScheme(),currentTheme=="dark"&&document.documentElement.setAttribute("data-theme","dark"),currentTheme=="auto"&&(autoChangeScheme(autoDefinedScheme),autoDefinedScheme.addListener(autoChangeScheme)),changeButtonText(),switchButton.addEventListener("click",switchTheme,!1)});function detectCurrentScheme(){return localStorage.getItem(STORAGE_KEY)?localStorage.getItem(STORAGE_KEY):defaultTheme?defaultTheme:window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":"light"}function changeButtonText(){switchButton.innerHTML=currentTheme=="dark"?moonSVG:sunSVG}function switchTheme(){currentTheme=="dark"?(localStorage.setItem(STORAGE_KEY,"light"),document.documentElement.setAttribute("data-theme","light"),currentTheme="light"):(localStorage.setItem(STORAGE_KEY,"dark"),document.documentElement.setAttribute("data-theme","dark"),currentTheme="dark"),changeButtonText()}</script></div></header><main id=main tabindex=-1><article class=post><header class=post-header><h1 class=post-title>mock-inspect: Mock network requests and observe how these requests were made</h1></header><div class=content><div class=post-heroimage><img src=https://rickschubert.net/blog/images/mock-inspect-chameleon.png></div><div class=callout>This article is part of a series about the open-source Node.js testing library mock-inspect of which I am the main contributor and author. <a href=https://rickschubert.net/blog/tags/mock-inspect>Check out the entire series here!</a></div><p><a href=https://github.com/trayio/mock-inspect>mock-inspect is an open-source library</a> for Node.js which allows you to mock network requests in your tests and to inspect how these requests have been made in the application. Has the endpoint been called? Which request body and request headers did the application pass along? This knowledge can be used to create your very own assertions, entirely depending on your use case.</p><p>Since mock-inspect is a Node.js library, it can be used both for frontend as well as backend applications. In this blog post, we want to explore the use case in a frontend project using React and how we can elevate our tests thanks to mock-inspect.</p><h2 id=application-outline>Application Outline</h2><p>To demonstrate the usage of mock-inspect, I have prepared an <a href=http://github.com/rickschubert/mock-inspect-react-app-example>example frontend application</a> which is inspired by a real-life use case, the <a href=https://tray.io>tray.io marketing website</a>. Users can fill out a form to request a specific type of demo for the product. When the form is submitted, an API endpoint is pinged with all the properties that the user supplied. The frontend application always calls the same endpoint, no matter which selection the user makes. That endpoint will return a 200 status code, no matter what. Once the frontend application has forwarded the properties, it displays a message which says that the user is going to receive an e-mail. Note that the e-mail is <em>scheduled</em> to be sent; it could also be sent a few hours later.</p><p>A recording of the user flow:</p><img src=https://rickschubert.net/blog/images/mock-inspect_example_app_flow.gif><p>Below is the React code for this simple application (feel free to skip over this one):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#e6db74>&#34;./App.css&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> {<span style=color:#a6e22e>useState</span>} <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;react&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>App</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>setName</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>useState</span>(<span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>email</span>, <span style=color:#a6e22e>setEmail</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>useState</span>(<span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>demoType</span>, <span style=color:#a6e22e>setDemoType</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>useState</span>(<span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>submitted</span>, <span style=color:#a6e22e>setSubmitted</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>useState</span>(<span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>nameHandler</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>event</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setName</span>(<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>target</span>.<span style=color:#a6e22e>value</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>emailHandler</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>event</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setEmail</span>(<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>target</span>.<span style=color:#a6e22e>value</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>radioButtonHandler</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>event</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setDemoType</span>(<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>type</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>forwardInputs</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>dataToSend</span> <span style=color:#f92672>=</span> {<span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>email</span>, <span style=color:#a6e22e>demoType</span>}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#34;https://someapi.com/request-demo&#34;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;POST&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;Content-Type&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;application/json&#34;</span>,
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>body</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>dataToSend</span>),
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>status</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>200</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>setSubmitted</span>(<span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>getDemoForm</span> <span style=color:#f92672>=</span> () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;App-header&#34;</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>placeholder</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Your name&#34;</span> <span style=color:#a6e22e>onChange</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>nameHandler</span>} /&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>placeholder</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Your e-mail&#34;</span> <span style=color:#a6e22e>onChange</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>emailHandler</span>} /&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>label</span> <span style=color:#a6e22e>htmlFor</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;live&#34;</span>&gt;
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>Live</span> <span style=color:#a6e22e>Demo</span>
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>input</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;radio&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;live&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;live&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>onChange</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>radioButtonHandler</span>}
</span></span><span style=display:flex><span>          /&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>label</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>label</span> <span style=color:#a6e22e>htmlFor</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;recorded&#34;</span>&gt;
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>Recorded</span> <span style=color:#a6e22e>Demo</span>
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>input</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;radio&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;recorded&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;recorded&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>onChange</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>radioButtonHandler</span>}
</span></span><span style=display:flex><span>          /&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>label</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>label</span> <span style=color:#a6e22e>htmlFor</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;1-2-1&#34;</span>&gt;
</span></span><span style=display:flex><span>          <span style=color:#ae81ff>1</span><span style=color:#f92672>-</span><span style=color:#ae81ff>2</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>with</span> <span style=color:#a6e22e>a</span> <span style=color:#a6e22e>representative</span>
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>input</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;radio&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;1-2-1&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;1-2-1&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>onChange</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>radioButtonHandler</span>}
</span></span><span style=display:flex><span>          /&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>label</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>br</span> /&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;button&#34;</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Submit&#34;</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>forwardInputs</span>} /&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>getThankYouPage</span> <span style=color:#f92672>=</span> () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;App-header&#34;</span>&gt;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Thank</span> <span style=color:#a6e22e>you</span><span style=color:#f92672>!</span> <span style=color:#a6e22e>We</span> <span style=color:#a6e22e>will</span> <span style=color:#a6e22e>send</span> <span style=color:#a6e22e>you</span> <span style=color:#a6e22e>a</span> <span style=color:#a6e22e>confirmation</span> <span style=color:#a6e22e>e</span><span style=color:#f92672>-</span><span style=color:#a6e22e>mail</span>.
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;App&#34;</span>&gt;{<span style=color:#f92672>!</span><span style=color:#a6e22e>submitted</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>getDemoForm</span>() <span style=color:#f92672>:</span> <span style=color:#a6e22e>getThankYouPage</span>()}&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>App</span>
</span></span></code></pre></div><p>How do we test this? In order to make our unit tests stable, we will want to mock the network request so that the tests work independently from the real-world application. <a href=https://mswjs.io/docs/recipes/request-assertions>Many mocking tools</a> will advise that a good test should check if the application correctly <em>consumes</em> the API response. But as we have seen in the use case description, there is nothing for our frontend application to consume - the API will return a 200 status code no matter what! In essence, all our application does is forwarding some properties. This is precisely why designing our test around the consumption of the API response would be too simple; we would not test enough by merely testing whether the application reacts to the 200 status code. What is actually important about our use case is that the frontend forwards the correct properties and in the correct format.</p><p>Let&rsquo;s start writing a test for our application. As a start, we are going to use the approach of checking that the application consumes the API response. Below is a test for this in which we are already using mock-inspect to set up the request mock. Apart from that, we are using <a href=https://testing-library.com/docs/react-testing-library/intro/>React Testing Library</a> to enter text into the inputs and to select our desired demo type.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>import</span> {<span style=color:#a6e22e>render</span>, <span style=color:#a6e22e>screen</span>, <span style=color:#a6e22e>fireEvent</span>, <span style=color:#a6e22e>waitFor</span>} <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;@testing-library/react&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>App</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;./App&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> {<span style=color:#a6e22e>mockRequest</span>} <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;mock-inspect&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>test</span>(<span style=color:#e6db74>&#34;shows Thank You page on submitting the form&#34;</span>, <span style=color:#66d9ef>async</span> () =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mockRequest</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>requestPattern</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;https://someapi.com/request-demo&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>requestMethod</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;POST&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>responseStatus</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>200</span>,
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>render</span>(<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>App</span> <span style=color:#f92672>/&gt;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>nameInput</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>screen</span>.<span style=color:#a6e22e>getByPlaceholderText</span>(<span style=color:#e6db74>&#34;Your name&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fireEvent</span>.<span style=color:#a6e22e>change</span>(<span style=color:#a6e22e>nameInput</span>, {<span style=color:#a6e22e>target</span><span style=color:#f92672>:</span> {<span style=color:#a6e22e>value</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Han Solo&#34;</span>}})
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>emailInput</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>screen</span>.<span style=color:#a6e22e>getByPlaceholderText</span>(<span style=color:#e6db74>&#34;Your e-mail&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fireEvent</span>.<span style=color:#a6e22e>change</span>(<span style=color:#a6e22e>emailInput</span>, {<span style=color:#a6e22e>target</span><span style=color:#f92672>:</span> {<span style=color:#a6e22e>value</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;i-shot-first@coruscant.sw&#34;</span>}})
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>recordedRadio</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>screen</span>.<span style=color:#a6e22e>getByLabelText</span>(<span style=color:#e6db74>&#34;Recorded Demo&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fireEvent</span>.<span style=color:#a6e22e>click</span>(<span style=color:#a6e22e>recordedRadio</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>submitButton</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>screen</span>.<span style=color:#a6e22e>getByDisplayValue</span>(<span style=color:#e6db74>&#34;Submit&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>expect</span>(<span style=color:#a6e22e>submitButton</span>).<span style=color:#a6e22e>toBeInTheDocument</span>()
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fireEvent</span>.<span style=color:#a6e22e>click</span>(<span style=color:#a6e22e>submitButton</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>waitFor</span>(() =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>expect</span>(<span style=color:#a6e22e>submitButton</span>).<span style=color:#a6e22e>not</span>.<span style=color:#a6e22e>toBeInTheDocument</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>thankYouPage</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>screen</span>.<span style=color:#a6e22e>getByText</span>(
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;Thank you! We will send you a confirmation e-mail.&#34;</span>,
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>expect</span>(<span style=color:#a6e22e>thankYouPage</span>).<span style=color:#a6e22e>toBeInTheDocument</span>()
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>})
</span></span></code></pre></div><p>Great, this test passes! Job done, right? After all, our application is forwarding the request payload of <code>{"demoType": "recorded", "name:" "Han Solo", "email": "i-shot-first@coruscant.sw"}</code> to the API. Well, &mldr; it doesn&rsquo;t. Our test let a bug slip: instead of forwarding <code>"demoType": "recorded"</code>, it sends <code>"demoType": "change"</code>. Why is that? This is caused by a problem with the handler function of the radio buttons. We made a human error and sent <code>event.type</code> instead of <code>event.target.value</code>, probably because we were too focused on the word &ldquo;type&rdquo; in the <code>setDemoType</code> function. But we can fix this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span>    // Inside App.js
</span></span><span style=display:flex><span>    const radioButtonHandler = (event) =&gt; {
</span></span><span style=display:flex><span><span style=color:#f92672>-       setDemoType(event.type)
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+       setDemoType(event.target.value)
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>    }
</span></span></code></pre></div><p>But our test still doesn&rsquo;t confirm whether the right properties are forwarded. Yes, we land on the Thank You page if we get a 200 status code from the backend; but we don&rsquo;t know whether we send the right things. This is where mock-inspect comes to the rescue.</p><p>Whenever you mock a network request using mock-inspect&rsquo;s <code>mockRequest</code> method, you receive a class instance. This instance contains a few useful methods, such as the method <code>expectRequestToHaveBeenMade()</code> which would throw an error if the application hasn&rsquo;t made the request. Another useful method is <code>inspect()</code> which will return the request payload and the request headers which have been used by the application when it made the request. Should the request not have been made at the time of calling <code>inspect()</code>, the method would throw an error (as it internally calls <code>expectRequestToHaveBeenMade()</code>).</p><p>Thanks to the <code>inspect()</code> method, we can complete our test and assert that the frontend application does indeed forward the correct properties. Now we really can be sure everything works as expected!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span>test(&#34;shows Thank You page on submitting the form&#34;, async () =&gt; {
</span></span><span style=display:flex><span><span style=color:#f92672>- mockRequest({
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+ const demoRequest = mockRequest({
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>    requestPattern: &#34;https://someapi.com/request-demo&#34;,
</span></span><span style=display:flex><span>    requestMethod: &#34;POST&#34;,
</span></span><span style=display:flex><span>    responseStatus: 200,
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  render(&lt;App /&gt;)
</span></span><span style=display:flex><span>  const nameInput = screen.getByPlaceholderText(&#34;Your name&#34;)
</span></span><span style=display:flex><span>  fireEvent.change(nameInput, {target: {value: &#34;Han Solo&#34;}})
</span></span><span style=display:flex><span>  const emailInput = screen.getByPlaceholderText(&#34;Your e-mail&#34;)
</span></span><span style=display:flex><span>  fireEvent.change(emailInput, {target: {value: &#34;i-shot-first@coruscant.sw&#34;}})
</span></span><span style=display:flex><span>  const recordedRadio = screen.getByLabelText(&#34;Recorded Demo&#34;)
</span></span><span style=display:flex><span>  fireEvent.click(recordedRadio)
</span></span><span style=display:flex><span>  const submitButton = screen.getByDisplayValue(&#34;Submit&#34;)
</span></span><span style=display:flex><span>  expect(submitButton).toBeInTheDocument()
</span></span><span style=display:flex><span>  fireEvent.click(submitButton)
</span></span><span style=display:flex><span>  await waitFor(() =&gt; {
</span></span><span style=display:flex><span>    expect(submitButton).not.toBeInTheDocument()
</span></span><span style=display:flex><span>    const thankYouPage = screen.getByText(
</span></span><span style=display:flex><span>      &#34;Thank you! We will send you a confirmation e-mail.&#34;,
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    expect(thankYouPage).toBeInTheDocument()
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>+ // is also called inside `inspect()` - here for clarity
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>+ demoRequest.expectRequestToHaveBeenMade()
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>+ const {requestBody} = demoRequest.inspect()
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>+ expect(requestBody).toEqual({
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>+   name: &#34;Han Solo&#34;,
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>+   email: &#34;i-shot-first@coruscant.sw&#34;,
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>+   demoType: &#34;recorded&#34;,
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>+ })
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>})
</span></span></code></pre></div><h2 id=conclusion>Conclusion</h2><p>We have seen how mock-inspect can help you write better and more meaningful tests. If you want to learn more about the library, head over to our <a href=http://github.com/trayio/mock-inspect>GitHub page</a> where you can find detailed instructions on how to use mock-inspect. There, we also outline other functionalities we haven&rsquo;t discussed yet, such as how to handle GraphQL and how to auto-generate responses using a GraphQL schema!</p><p>Keep an eye out for other upcoming articles <a href=https://rickschubert.net/blog/tags/mock-inspect>in this series</a>. In future blog posts, we will look at how mock-inspect works behind the scenes and how it can be used to facilitate contract testing.</p><hr><p><a href=https://github.com/trayio/mock-inspect/tree/main/assets/chameleon.png>Chameleon</a> graphic by <a href="https://pixabay.com/users/monstreh-637659/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=3340930">Анна Куликова</a> from <a href="https://pixabay.com/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=3340930">Pixabay</a></p></div><div class=post-info><div class=post-date>10 May 2021</div><div class=post-taxonomies><ul class=post-tags><li><a href=https://rickschubert.net/blog/tags/programming>#programming</a></li><li><a href=https://rickschubert.net/blog/tags/mock-inspect>#mock-inspect</a></li></ul></div></div></article><div class="pagination post-pagination"><div class="left pagination-item"><a href=https://rickschubert.net/blog/posts/mock-inspect-contract-testing/>mock-inspect: A simple way to achieve contract testing</a></div><div class="right pagination-item"><a href=https://rickschubert.net/blog/posts/windows-linux-subsystem/>Windows Subsystem for Linux</a></div></div></main><footer class=common-footer><a class=rss href=https://rickschubert.net/blog/index.xml><img src=https://rickschubert.net/blog/images/rss.svg> Subscribe to RSS feed</a><nav><a href=https://rickschubert.net/blog/posts/ title=Archive>Archive</a></nav><div class=common-footer-bottom><div class=copyright><p>© Rick Schubert, 2022<br></p></div></div></footer></div></body></html>